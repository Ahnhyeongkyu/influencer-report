<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ campaign_name }} - 캠페인 성과 리포트</title>
    <style>
        /* 기본 스타일 */
        @page {
            size: A4;
            margin: 15mm 15mm 20mm 15mm;

            @bottom-center {
                content: "{{ campaign_name }} - {{ advertiser_name }}";
                font-size: 9pt;
                color: #666;
            }

            @bottom-right {
                content: counter(page) " / " counter(pages);
                font-size: 9pt;
                color: #666;
            }
        }

        @page :first {
            @bottom-center {
                content: none;
            }
            @bottom-right {
                content: none;
            }
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Malgun Gothic', 'NanumGothic', sans-serif;
            font-size: 10pt;
            line-height: 1.6;
            color: #333;
            background: #fff;
        }

        /* 표지 스타일 */
        .cover-page {
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            text-align: center;
            background: linear-gradient(135deg, #1a365d 0%, #2d5a87 50%, #3d7ab8 100%);
            color: white;
            page-break-after: always;
            padding: 40px;
        }

        .cover-logo {
            width: 120px;
            height: 120px;
            border: 3px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 40px;
            font-size: 36pt;
            font-weight: bold;
            background: rgba(255,255,255,0.1);
        }

        .cover-title {
            font-size: 28pt;
            font-weight: bold;
            margin-bottom: 15px;
            letter-spacing: 2px;
        }

        .cover-subtitle {
            font-size: 14pt;
            color: rgba(255,255,255,0.9);
            margin-bottom: 50px;
        }

        .cover-info {
            background: rgba(255,255,255,0.1);
            padding: 30px 50px;
            border-radius: 10px;
            margin-bottom: 40px;
        }

        .cover-info-item {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
        }

        .cover-info-item:last-child {
            border-bottom: none;
        }

        .cover-info-label {
            color: rgba(255,255,255,0.7);
            font-size: 11pt;
            min-width: 100px;
            text-align: left;
        }

        .cover-info-value {
            font-weight: bold;
            font-size: 12pt;
            text-align: right;
        }

        .cover-date {
            font-size: 10pt;
            color: rgba(255,255,255,0.7);
            margin-top: 30px;
        }

        /* 섹션 스타일 */
        .section {
            margin-bottom: 30px;
        }

        .section-title {
            font-size: 16pt;
            font-weight: bold;
            color: #1a365d;
            border-bottom: 3px solid #3d7ab8;
            padding-bottom: 10px;
            margin-bottom: 20px;
        }

        .section-subtitle {
            font-size: 12pt;
            font-weight: bold;
            color: #2d5a87;
            margin-bottom: 15px;
            margin-top: 20px;
        }

        /* 요약 카드 */
        .summary-cards {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .summary-card {
            flex: 1;
            min-width: 120px;
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .summary-card-value {
            font-size: 20pt;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 5px;
        }

        .summary-card-label {
            font-size: 9pt;
            color: #666;
            text-transform: uppercase;
        }

        .summary-card.highlight {
            background: linear-gradient(135deg, #1a365d, #2d5a87);
            color: white;
        }

        .summary-card.highlight .summary-card-value {
            color: white;
        }

        .summary-card.highlight .summary-card-label {
            color: rgba(255,255,255,0.8);
        }

        /* 테이블 스타일 */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-bottom: 20px;
            font-size: 9pt;
        }

        th, td {
            padding: 10px 8px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
        }

        th {
            background: #1a365d;
            color: white;
            font-weight: bold;
            text-transform: uppercase;
            font-size: 8pt;
            letter-spacing: 0.5px;
        }

        tr:nth-child(even) {
            background: #f8fafc;
        }

        tr:hover {
            background: #edf2f7;
        }

        td.number {
            text-align: right;
            font-family: 'Consolas', monospace;
        }

        td.url {
            max-width: 200px;
            word-wrap: break-word;
            word-break: break-all;
            font-size: 8pt;
            color: #666;
        }

        /* 플랫폼 뱃지 */
        .platform-badge {
            display: inline-block;
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 8pt;
            font-weight: bold;
            color: white;
        }

        .platform-xiaohongshu { background: #FF2442; }
        .platform-youtube { background: #FF0000; }
        .platform-instagram { background: #E4405F; }
        .platform-facebook { background: #1877F2; }
        .platform-dcard { background: #006AA6; }

        /* 차트 컨테이너 */
        .chart-container {
            text-align: center;
            margin: 20px 0;
            page-break-inside: avoid;
        }

        .chart-image {
            max-width: 100%;
            height: auto;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
        }

        .chart-title {
            font-size: 11pt;
            font-weight: bold;
            color: #1a365d;
            margin-bottom: 10px;
        }

        /* 페이지 나눔 */
        .page-break {
            page-break-before: always;
        }

        /* 플랫폼 섹션 */
        .platform-section {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            page-break-inside: avoid;
        }

        .platform-header {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .platform-icon {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 14pt;
            margin-right: 15px;
        }

        .platform-name {
            font-size: 14pt;
            font-weight: bold;
            color: #1a365d;
        }

        .platform-stats {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
        }

        .platform-stat {
            text-align: center;
        }

        .platform-stat-value {
            font-size: 16pt;
            font-weight: bold;
            color: #1a365d;
        }

        .platform-stat-label {
            font-size: 9pt;
            color: #666;
        }

        /* 푸터 */
        .report-footer {
            text-align: center;
            color: #666;
            font-size: 9pt;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }

        /* 에러 행 */
        tr.error-row {
            background: #fff5f5;
        }

        tr.error-row td {
            color: #c53030;
        }

        /* 상태 뱃지 */
        .status-success {
            color: #38a169;
            font-weight: bold;
        }

        .status-error {
            color: #c53030;
            font-weight: bold;
        }

        /* 플랫폼별 요약 그리드 */
        .platform-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
    </style>
</head>
<body>
    <!-- 표지 -->
    <div class="cover-page">
        <div class="cover-logo">
            {% if logo_base64 %}
            <img src="data:image/png;base64,{{ logo_base64 }}" alt="Logo" style="width: 100%; height: 100%; object-fit: contain;">
            {% else %}
            PR
            {% endif %}
        </div>

        <h1 class="cover-title">캠페인 성과 리포트</h1>
        <p class="cover-subtitle">인플루언서 마케팅 성과 분석</p>

        <div class="cover-info">
            <div class="cover-info-item">
                <span class="cover-info-label">캠페인명</span>
                <span class="cover-info-value">{{ campaign_name }}</span>
            </div>
            <div class="cover-info-item">
                <span class="cover-info-label">광고주</span>
                <span class="cover-info-value">{{ advertiser_name }}</span>
            </div>
            <div class="cover-info-item">
                <span class="cover-info-label">캠페인 기간</span>
                <span class="cover-info-value">{{ start_date }} ~ {{ end_date }}</span>
            </div>
            <div class="cover-info-item">
                <span class="cover-info-label">총 게시물</span>
                <span class="cover-info-value">{{ total_posts }}개</span>
            </div>
        </div>

        <p class="cover-date">리포트 생성일: {{ generated_date }}</p>
    </div>

    <!-- 요약 섹션 -->
    <div class="section">
        <h2 class="section-title">1. 캠페인 성과 요약</h2>

        <div class="summary-cards">
            <div class="summary-card highlight">
                <div class="summary-card-value">{{ total_posts }}</div>
                <div class="summary-card-label">총 게시물</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ success_count }}</div>
                <div class="summary-card-label">성공</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ total_views_formatted }}</div>
                <div class="summary-card-label">총 조회수</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ total_likes_formatted }}</div>
                <div class="summary-card-label">총 좋아요</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ total_comments_formatted }}</div>
                <div class="summary-card-label">총 댓글</div>
            </div>
        </div>

        <div class="summary-cards">
            <div class="summary-card">
                <div class="summary-card-value">{{ total_shares_formatted }}</div>
                <div class="summary-card-label">총 공유</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ total_favorites_formatted }}</div>
                <div class="summary-card-label">총 즐겨찾기</div>
            </div>
            <div class="summary-card highlight">
                <div class="summary-card-value">{{ total_engagement_formatted }}</div>
                <div class="summary-card-label">총 인게이지먼트</div>
            </div>
            <div class="summary-card">
                <div class="summary-card-value">{{ avg_engagement_formatted }}</div>
                <div class="summary-card-label">평균 인게이지먼트</div>
            </div>
        </div>

        <!-- 인게이지먼트 분포 차트 -->
        {% if charts.engagement_pie %}
        <div class="chart-container">
            <img class="chart-image" src="data:image/png;base64,{{ charts.engagement_pie }}" alt="인게이지먼트 분포">
        </div>
        {% endif %}
    </div>

    <!-- 플랫폼별 성과 섹션 -->
    <div class="section page-break">
        <h2 class="section-title">2. 플랫폼별 성과</h2>

        <!-- 플랫폼별 요약 테이블 -->
        <table>
            <thead>
                <tr>
                    <th>플랫폼</th>
                    <th>게시물</th>
                    <th>조회수</th>
                    <th>좋아요</th>
                    <th>댓글</th>
                    <th>공유</th>
                    <th>즐겨찾기</th>
                    <th>인게이지먼트</th>
                </tr>
            </thead>
            <tbody>
                {% for platform in platform_summary %}
                <tr>
                    <td>
                        <span class="platform-badge platform-{{ platform.code }}">{{ platform.name }}</span>
                    </td>
                    <td class="number">{{ platform.count }}</td>
                    <td class="number">{{ platform.views_formatted }}</td>
                    <td class="number">{{ platform.likes_formatted }}</td>
                    <td class="number">{{ platform.comments_formatted }}</td>
                    <td class="number">{{ platform.shares_formatted }}</td>
                    <td class="number">{{ platform.favorites_formatted }}</td>
                    <td class="number">{{ platform.engagement_formatted }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        <!-- 플랫폼별 인게이지먼트 비교 차트 -->
        {% if charts.platform_engagement %}
        <div class="chart-container">
            <img class="chart-image" src="data:image/png;base64,{{ charts.platform_engagement }}" alt="플랫폼별 인게이지먼트 비교">
        </div>
        {% endif %}

        <!-- 플랫폼별 게시물 분포 차트 -->
        {% if charts.platform_posts %}
        <div class="chart-container">
            <img class="chart-image" src="data:image/png;base64,{{ charts.platform_posts }}" alt="플랫폼별 게시물 분포">
        </div>
        {% endif %}

        <!-- 조회수 비교 차트 -->
        {% if charts.views_bar %}
        <div class="chart-container">
            <img class="chart-image" src="data:image/png;base64,{{ charts.views_bar }}" alt="플랫폼별 조회수">
        </div>
        {% endif %}
    </div>

    <!-- 상위 게시물 섹션 -->
    {% if charts.top_posts_likes %}
    <div class="section page-break">
        <h2 class="section-title">3. 상위 게시물</h2>

        <div class="chart-container">
            <img class="chart-image" src="data:image/png;base64,{{ charts.top_posts_likes }}" alt="상위 게시물 (좋아요 기준)">
        </div>
    </div>
    {% endif %}

    <!-- 개별 게시물 데이터 -->
    <div class="section page-break">
        <h2 class="section-title">{% if charts.top_posts_likes %}4{% else %}3{% endif %}. 개별 게시물 상세</h2>

        <table>
            <thead>
                <tr>
                    <th style="width: 8%;">번호</th>
                    <th style="width: 12%;">플랫폼</th>
                    <th style="width: 15%;">작성자</th>
                    <th style="width: 25%;">URL</th>
                    <th style="width: 10%;">조회수</th>
                    <th style="width: 10%;">좋아요</th>
                    <th style="width: 10%;">댓글</th>
                    <th style="width: 10%;">공유</th>
                </tr>
            </thead>
            <tbody>
                {% for post in posts %}
                <tr class="{% if post.error %}error-row{% endif %}">
                    <td class="number">{{ loop.index }}</td>
                    <td>
                        <span class="platform-badge platform-{{ post.platform }}">{{ post.platform_name }}</span>
                    </td>
                    <td>{{ post.author|default('-', true) }}</td>
                    <td class="url">{{ post.url_short }}</td>
                    <td class="number">{{ post.views_formatted }}</td>
                    <td class="number">{{ post.likes_formatted }}</td>
                    <td class="number">{{ post.comments_formatted }}</td>
                    <td class="number">{{ post.shares_formatted }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>

        {% if error_count > 0 %}
        <p style="color: #c53030; font-size: 9pt; margin-top: 10px;">
            * 빨간색으로 표시된 {{ error_count }}개 게시물은 데이터 수집에 실패했습니다.
        </p>
        {% endif %}
    </div>

    <!-- 푸터 -->
    <div class="report-footer">
        <p>본 리포트는 자동 생성되었습니다.</p>
        <p>데이터 수집 시점: {{ generated_date }}</p>
    </div>
</body>
</html>
